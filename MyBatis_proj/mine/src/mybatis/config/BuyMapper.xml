<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ðŸ“Œ ì´ ë§¤í¼ XMLì€ BuyMapper.java ì¸í„°íŽ˜ì´ìŠ¤ì™€ ì—°ê²°ë©ë‹ˆë‹¤ -->
<mapper namespace="mapper.BuyMapper">

    <!-- âœ… 1. ì‚¬ìš©ìž IDë¡œ êµ¬ë§¤ ë‚´ì—­ ì¡°íšŒ -->
    <!-- í˜¸ì¶œ: selectByCustomerId(String customerId) -->
    <select id="selectByCustomerId" parameterType="String" resultType="BuyVo">
        SELECT 
            BUY_SEQ        AS buyIdx,
            CUSTOMER_ID    AS customerId,
            PCODE,
            QUANTITY,
            BUY_DATE       AS buyDate
        FROM TBL_BUY
        WHERE CUSTOMER_ID = #{customerId}
    </select>

    <!-- âœ… 2. ìƒí’ˆ ì½”ë“œë¡œ êµ¬ë§¤ ë‚´ì—­ ì¡°íšŒ -->
    <!-- í˜¸ì¶œ: selectByPcode(String pcode) -->
    <select id="selectByPcode" parameterType="String" resultType="BuyVo">
        SELECT 
            BUY_SEQ        AS buyIdx,
            CUSTOMER_ID    AS customerId,
            PCODE,
            QUANTITY,
            BUY_DATE       AS buyDate
        FROM TBL_BUY
        WHERE PCODE = #{pcode}
    </select>

    <!-- âœ… 3. ì—°ë„ë³„ êµ¬ë§¤ ë‚´ì—­ ì¡°íšŒ -->
    <!-- í˜¸ì¶œ: selectByYear(String year) -->
    <select id="selectByYear" parameterType="String" resultType="BuyVo">
        SELECT 
            BUY_SEQ        AS buyIdx,
            CUSTOMER_ID    AS customerId,
            PCODE,
            QUANTITY,
            BUY_DATE       AS buyDate
        FROM TBL_BUY
        WHERE TO_CHAR(BUY_DATE, 'YYYY') = #{year}
    </select>

    <!-- âœ… 4. íŠ¹ì • ìƒí’ˆì½”ë“œ ê¸°ì¤€ êµ¬ë§¤ ìˆ˜ëŸ‰ í•©ê³„ -->
    <!-- í˜¸ì¶œ: selectSumByPcode(String pcode) -->
    <select id="selectSumByPcode" parameterType="String" resultType="int">
        SELECT SUM(QUANTITY)
        FROM TBL_BUY
        WHERE PCODE = #{pcode}
    </select>

    <!-- âœ… 5. ì „ì²´ ì´ êµ¬ë§¤ ìˆ˜ëŸ‰ í•©ê³„ -->
    <!-- í˜¸ì¶œ: selectTotalQuantity() -->
    <select id="selectTotalQuantity" resultType="int">
        SELECT SUM(QUANTITY)
        FROM TBL_BUY
    </select>

    <!-- âœ… 6. ìƒí’ˆì½”ë“œë³„ êµ¬ë§¤ ìˆ˜ëŸ‰ ì§‘ê³„ -->
    <!-- í˜¸ì¶œ: sumByPcodeGroup() -->
    <select id="sumByPcodeGroup" resultType="map">
        SELECT 
            PCODE,
            SUM(QUANTITY) AS TOTAL
        FROM TBL_BUY
        GROUP BY PCODE
    </select>

    <!-- âœ… 7. ê³ ê° IDë³„ êµ¬ë§¤ ìˆ˜ëŸ‰ ì§‘ê³„ -->
    <!-- í˜¸ì¶œ: sumByCustomerGroup() -->
    <select id="sumByCustomerGroup" resultType="map">
        SELECT 
            CUSTOMER_ID,
            SUM(QUANTITY) AS TOTAL
        FROM TBL_BUY
        GROUP BY CUSTOMER_ID
    </select>

    <!-- âœ… 8. ì—°ë„ë³„ êµ¬ë§¤ ìˆ˜ëŸ‰ ì§‘ê³„ -->
    <!-- í˜¸ì¶œ: sumByYearGroup() -->
    <select id="sumByYearGroup" resultType="map">
        SELECT 
            TO_CHAR(BUY_DATE, 'YYYY') AS YEAR,
            SUM(QUANTITY) AS TOTAL
        FROM TBL_BUY
        GROUP BY TO_CHAR(BUY_DATE, 'YYYY')
    </select>

    <!-- âœ… 9. ì „ì²´ êµ¬ë§¤ ë‚´ì—­ ì „ì²´ ì¡°íšŒ -->
    <!-- í˜¸ì¶œ: selectAll() -->
    <select id="selectAll" resultType="BuyVo">
        SELECT 
            BUY_SEQ        AS buyIdx,
            CUSTOMER_ID    AS customerId,
            PCODE,
            QUANTITY,
            BUY_DATE       AS buyDate
        FROM TBL_BUY
        ORDER BY BUY_SEQ
    </select>
</mapper>
